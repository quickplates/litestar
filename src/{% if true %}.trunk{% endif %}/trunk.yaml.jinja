version: 0.1
cli:
  version: 1.25.0
plugins:
  sources:
    - id: trunk
      ref: v1.7.4
      uri: https://github.com/trunk-io/plugins
runtimes:
  enabled:
    # Needed for gitleaks, shfmt
    - go@1.25.0
    # Needed for {% if docs %}eslint, {% endif %}markdownlint, prettier, pyright{% if docs %}, stylelint, svgo{% endif %}
    - node@22.20.0
    # Needed for ruff, yamllint
    - python@3.13.3
lint:
  ignore:
    - linters: [ALL]
      paths:
        # Ignore copier answers file
        - "**/.copier-answers.yaml"
  definitions:
    # Nix formatting check (local)
    - name: nix-fmt-check
      files: [nix]
      commands:
        - output: pass_fail
          read_output_from: stderr
          run: >-
            nix
            --accept-flake-config
            --extra-experimental-features
            'nix-command flakes'
            --no-warn-dirty
            fmt
            --
            --check
            ${target}
          success_codes: [0, 1]
    # Nix flake check (local)
    - name: nix-flake-check
      files: [nix]
      commands:
        - output: pass_fail
          target: ./
          read_output_from: stderr
          run: >-
            nix
            --accept-flake-config
            --extra-experimental-features
            'nix-command flakes'
            --no-warn-dirty
            flake
            check
            path:${target}
          success_codes: [0, 1]
    {%- if docs %}
    # Override default eslint definition
    - name: eslint
      commands:
        - name: lint
          run_from: ${root_or_parent_with_direct_config}
    # Override default stylelint definition
    - name: stylelint
      commands:
        - name: lint
          run_from: ${root_or_parent_with_direct_config}
        - name: fix
          run_from: ${root_or_parent_with_direct_config}
    {%- endif %}
  enabled:
    # GitHub Actions linting
    - actionlint@1.7.8
    {%- if docs %}
    # JavaScript and TypeScript linting
    - eslint@9.39.1
    {%- endif %}
    # Check for whitespace errors
    - git-diff-check
    # Check for secrets in the code
    - gitleaks@8.29.0
    # Dockerfile linting
    - hadolint@2.14.0
    # Markdown linting
    - markdownlint@0.45.0
    # Nix formatting check
    - nix-fmt-check@SYSTEM
    # Nix flake check
    - nix-flake-check@SYSTEM
    # {% if docs %}JS, TS, CSS, HTML, {% endif %}JSON, YAML, Markdown formatting
    - prettier@3.6.2:
        packages:
          # JSON sorting
          - prettier-plugin-sort-json@4.1.1
          {%- if docs %}
          # package.json sorting
          - prettier-plugin-packagejson@2.5.19
          {%- endif %}
    # Python type checking
    - pyright@1.1.407
    # Python formatting and linting
    - ruff@0.14.5:
        commands:
          - lint
          - format
    # Shell linting
    - shellcheck@0.11.0
    # Shell formatting
    - shfmt@3.12.0
    {%- if docs %}
    # CSS linting
    - stylelint@16.25.0
    # SVG formatting
    - svgo@4.0.0
    {%- endif %}
    # TOML formatting
    - taplo@0.10.0
    # YAML linting
    - yamllint@1.37.1
